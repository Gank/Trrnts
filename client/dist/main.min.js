/*! Trrnts 21-07-2014 */

angular.module("trrntsApp",["ui.router","trrntsApp.main"]).config(["$stateProvider",function(a){a.state("trrntsApp",{template:"<ui-view></ui-view>"})}]).run(["$state",function(a){a.transitionTo("trrntsApp.main")}]),angular.module("trrntsApp.controllers",[]).controller("SubmitMagnetLinkController",["$scope","MagnetLinksFactory",function(a,b){a.magnetURI="",a.submit=function(){a.magnetURI&&b.create(a.magnetURI).then(function(){a.error=null,a.success="Yeah! Success!",a.magnetURI=null}).catch(function(b){a.success=null,a.error=b.data.error})}}]).controller("LatestMagnetLinksController",["$scope","MagnetLinksFactory","SharedService",function(a,b,c){a.perPage=10,a.start=0,a.stop=a.start+a.perPage-1,a.busy=!1,a.latest=[],a.openModal=function(a){c.prepForBroadcast(a)},a.loadMore=function(){a.busy||(a.busy=!0,b.latest(a.start,a.stop).then(function(b){a.latest=a.latest.concat(b.data),a.start+=a.perPage,a.stop+=a.perPage,a.busy=!1}))}}]).controller("TopMagnetLinksController",["$scope","MagnetLinksFactory","SharedService",function(a,b,c){a.perPage=10,a.start=0,a.stop=a.start+a.perPage-1,a.busy=!1,a.top=[],a.openModal=function(a){c.prepForBroadcast(a)},a.loadMore=function(){a.busy||(a.busy=!0,b.top(a.start,a.stop).then(function(b){a.top=a.top.concat(b.data),a.start+=a.perPage,a.stop+=a.perPage,a.busy=!1}))}}]).controller("SearchBoxController",["$scope","$state",function(a,b){a.search=function(){b.go("trrntsApp.main.search",{query:a.query})}}]).controller("SearchResultsController",["$scope","$stateParams","MagnetLinksFactory","SharedService",function(a,b,c,d){a.results=[],a.query=b.query,a.openModal=function(a){d.prepForBroadcast(a)},c.search(a.query).then(function(b){a.results=b.data})}]).controller("WorldMapController",["$scope","GeoFactory",function(a,b){a.latAndLong={},a.countries={},a.cities={},a.numberOfCountries=15,a.numberOfLatAndLongs=100,a.numberOfCities=10,a.gotLL=!1,a.gotCountries=!1,a.gotCities=!1,a.getLatAndLong=function(c){b.getLatAndLong(c).then(function(b){a.latAndLong=b.data,a.gotLL=!0}).catch(function(a){console.log(a)})},a.getCountries=function(c){b.getCountries(c).then(function(b){a.countries=b.data,a.gotCountries=!0}).catch(function(a){console.log(a)})},a.getCities=function(c){b.getCities(c).then(function(b){a.cities=b.data,a.gotCities=!0}).catch(function(a){console.log(a)})},a.getLatAndLong(a.numberOfLatAndLongs),a.getCountries(a.numberOfCountries),a.getCities(a.numberOfCities)}]).controller("ModalViewController",["$scope","SharedService","$location","$state",function(a,b){a.modalShown=!0,console.log("Here"),a.selectedMagnet=b.selectedMagnet}]),angular.module("trrntsApp.directives",[]).directive("counter",function(){return{restrict:"A",link:function(a,b,c){var d=parseInt(c.max),e=0;b=b[0],e=-2,d>100&&(e=d-100);var f=function(){g(),e+=1,b.textContent=e,d>e&&setTimeout(f,1)},g=function(){var a=e/1e3;.2>a&&(a=.2),a>1&&(a=.6),b.style.color="rgba(0, 0, 0, "+a+")"};f()}}}).directive("barChart",function(){return{restrict:"A",link:function(a,b,c){if(void 0!==a.selectedMagnet){b=b[0];for(var d=c.barWidth||20,e=c.barSpace||1,f=c.barChartHeight||70,g=c.highlightHeightDiff||20,h=a.selectedMagnet.peers||{},i=d3.select(b),j=[],k=0;k<h.length;k+=2)j.unshift({peers:parseInt(h[k]),t:parseInt(h[k+1])});h=j;var l=d3.scale.linear().domain([0,d3.max(h,function(a){return a.peers})]).range([0,f-g]),m=d3.tip().attr("class","d3-tip").offset([-g-10,0]).html(function(a){return"<strong>"+a.peers+"</strong> peers <span>"+moment(parseInt(a.t)).fromNow()+"</span>"});i.call(m);var n=d3.select(b).selectAll("rect").data(h);n.enter().append("rect").attr("class","bar").attr("width",d).attr("x",function(a,b){return d*b+e*b}).attr("y",f).attr("height",0).transition().duration(300).ease("elastic").delay(function(a,b){return.7*b*30}).attr("y",function(a){return f-l(a.peers)}).attr("height",function(a){return l(a.peers)}),n.on("mouseover",function(a,b){n.filter(function(a,c){return c===b}).transition().ease("bounce").attr("y",function(){return f-l(a.peers)-g}).attr("height",function(){return l(a.peers)+g});m.show(a)}),n.on("mouseleave",function(a,b){n.filter(function(a,c){return c===b}).transition().ease("bounce").attr("y",function(a){return f-l(a.peers)}).attr("height",function(a){return l(a.peers)});m.hide(a)})}}}}).directive("worldMap",function(){return{restrict:"A",link:function(a,b){var c=function(a){var b=[],c=0;for(var e in a)parseInt(a[e])>c&&(c=parseInt(a[e]));for(e in a){var f={fillKey:"torrents",radius:d(50,c,a[e]),torrentsTotal:a[e]},g=e.split(",");f.latitude=g[0],f.longitude=g[1],g.length>1&&"?"!==g[0]&&b.push(f)}return b},d=function(a,b,c){return Math.floor(c/b*a)},e=new Datamap({element:b[0],fills:{defaultFill:"#ccc",torrents:"#222"}}),f=c(a.latAndLong);e.bubbles(f,{popupTemplate:function(a,b){return'<div class="hoverinfo"> Total Number of Torrents: <strong>'+b.torrentsTotal+"</strong></div>"}})}}}).directive("modalDialog",["$state",function(a){return{restrict:"E",scope:{show:"="},replace:!0,transclude:!0,link:function(b,c,d){b.dialogStyle={},d.width&&(b.dialogStyle.width=d.width),d.height&&(b.dialogStyle.height=d.height),b.hideModal=function(){a.go("^"),b.show=!1}},template:"<div class='ng-modal' ng-show='show'><div class='ng-modal-overlay' ng-click='hideModal()'></div><div class='ng-modal-dialog' ng-style='dialogStyle'><div class='ng-modal-close' ng-click='hideModal()'>X</div><div class='ng-modal-dialog-content' ng-transclude></div></div></div>"}}]).directive("donutChart",function(){return{restrict:"A",link:function(a,b,c){b=b[0];var d=[];console.log(a.countries,c.donutType);var e=a[c.donutType]||[10,20,30,40,50];if(Array.isArray(e)||"object"!=typeof e)d=e;else for(var f in e)"?"!==f&&d.push({label:f,value:e[f]});var g=c.donutRadius||200,h=2*g,i=2*g;outerRadius=h/2,innerRadius=h/3;var j=d3.layout.pie().sort(null).value(function(a){return a.value||a}),k=d3.svg.arc().outerRadius(outerRadius).innerRadius(innerRadius),l=d3.select(b).attr("width",h).attr("height",i).append("g").attr("transform","translate(0,"+i/6+")"),m=d3.scale.category20(),n=l.selectAll("g.arc").data(j(d)).enter().append("g").attr("class","arc").attr("transform","translate("+outerRadius+","+innerRadius+")");n.append("path").attr("fill",function(a,b){return m(b)}).attr("d",k),n.append("text").attr("transform",function(a){return"translate("+k.centroid(a)+")"}).attr("text-anchor","middle").text(function(a){return a.data.label})}}}),angular.module("trrntsApp.filters",[]).filter("agoFilter",function(){return function(a){return a=parseInt(a),moment(a).fromNow()}}),angular.module("trrntsApp.main",["trrntsApp.controllers","trrntsApp.services","trrntsApp.directives","trrntsApp.filters","infinite-scroll"]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise(""),a.state("trrntsApp.main",{url:"",views:{"":{templateUrl:"views/main.tpl.html",controller:["$state",function(a){""===a.current.url&&a.go("trrntsApp.main.top")}]},"searchMagnets@trrntsApp.main":{templateUrl:"views/searchMagnets.tpl.html",controller:"SearchMagnetLinksController"}}}).state("trrntsApp.main.top",{url:"/top",templateUrl:"views/topMagnets.tpl.html",controller:"TopMagnetLinksController"}).state("trrntsApp.main.latest",{url:"/latest",templateUrl:"views/latestMagnets.tpl.html",controller:"TopMagnetLinksController"}).state("trrntsApp.main.stats",{url:"/stats",templateUrl:"views/worldMap.tpl.html",controller:"WorldMapController"}).state("trrntsApp.main.submit",{url:"/submit",templateUrl:"views/submitMagnet.tpl.html",controller:"SubmitMagnetLinkController"}).state("trrntsApp.main.about",{url:"/about",templateUrl:"views/about.tpl.html"}).state("trrntsApp.main.search",{url:"/search?query",templateUrl:"views/searchMagnets.tpl.html",controller:"SearchResultsController"}).state("trrntsApp.main.top.detail",{url:"/detail",templateUrl:"views/detail.tpl.html",controller:"ModalViewController"}).state("trrntsApp.main.latest.detail",{url:"/detail/:magnetName",templateUrl:"views/detail.tpl.html",controller:"ModalViewController"}).state("trrntsApp.main.stats.detail",{url:"/detail/:magnetName",templateUrl:"views/detail.tpl.html",controller:"ModalViewController"})}]),angular.module("trrntsApp.services",[]).factory("MagnetLinksFactory",["$http","$q",function(a,b){var c=function(b){return a({method:"POST",url:"/api/magnets",data:{magnetURI:b}})},d=function(b,c){return a({method:"GET",url:"api/magnets/latest",params:{start:b||1,stop:c||30}})},e=function(b,c){return a({method:"GET",url:"api/magnets/top",params:{start:b||1,stop:c||30}})},f=function(c){return"string"!=typeof c?b.defer().promise:a({method:"GET",url:"api/magnets",params:{query:c}})};return{create:c,latest:d,top:e,search:f}}]).factory("SharedService",["$rootScope",function(a){var b={};return b.selectedMagnet="default",b.prepForBroadcast=function(a){this.selectedMagnet=a,this.broadcastItem()},b.broadcastItem=function(){a.$broadcast("handleBroadcast")},b}]).factory("GeoFactory",["$http",function(a){var b=function(b){return a({method:"GET",url:"api/locations",params:{query:"LatAndLong",number:b}})},c=function(b){return a({method:"GET",url:"api/locations",params:{query:"Country",number:b}})},d=function(b){return a({method:"GET",url:"api/locations",params:{query:"City",number:b}})};return{getLatAndLong:b,getCountries:c,getCities:d}}]);
//# sourceMappingURL=main.min.js.map